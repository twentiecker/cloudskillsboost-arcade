# Cloud Speech API 3 Ways: Challenge Lab

## Task 1. Create an API key

#### 1. For this task, you need to create an API key to use in this and other tasks when sending a request to the Speech-to-Text API.

> **Step1**. To create an API key, on the **Navigation menu** click **APIs & services > Credentials**.

> **Step2**. Click **Create credentials** and select **API key**.

#### 2. Save the API key to use in other tasks.

---

## Task 2. Create synthetic speech from text using the Text-to-Speech API

#### 1. For this task, connect to the VM instance lab-vm provisioned for you via SSH.

#### 2. Activate the virtual environment using the source venv/bin/activate command.

```bash
source venv/bin/activate
```

#### 3. Using a text editor (such as nano or vim), create a file named synthesize-text.json and paste provided lab code into the file.

```bash
nano synthesize-text.json
```

#### 4. Call the Text-to-Speech API to synthesize the text of the synthesize-text.json file, and store the result in a file named synthesize-text.txt.

```bash
curl -H "Authorization: Bearer "$(gcloud auth application-default print-access-token) \
 -H "Content-Type: application/json; charset=utf-8" \
 -d @synthesize-text.json "https://texttospeech.googleapis.com/v1/text:synthesize" \
> synthesize-text.txt
```

#### 5. Using a text editor (such as nano or vim), create a file named tts_decode.py and paste provided lab code into the file.

```bash
nano tts_decode.py
```

#### 6. Now, to create an audio file using the response you received from the Text-to-Speech API, run the following command from Cloud Shell:

```bash
python tts_decode.py --input "synthesize-text.txt" --output "synthesize-text-audio.mp3"
```

#### 7. Finally, download the audio file via the DOWNLOAD FILE option of the VM instance's SSH session in order to listen to it.

---

## Task 3. Perform speech to text transcription with the Cloud Speech API

#### Note: This lab uses a pre-recorded file that's available on Cloud Storage: gs://cloud-samples-data/speech/corbeau_renard.flac. You can listen to this file.

#### 1. For this task, connect to the VM instance lab-vm provisioned for you via SSH.

```bash
export API_KEY=<API_KEY>
```

#### 2. Using a text editor (such as nano or vim), create a file named <SPEECH_REQUEST_FILE> as your API request to transcribe the audio file available at the gs://cloud-samples-data/speech/corbeau_renard.flac location to French.

```bash
export SPEECH_REQUEST_FILE=<SPEECH_REQUEST_FILE>
```

```bash
cat > $SPEECH_REQUEST_FILE <<EOF
{
  "config": {
    "encoding": "FLAC",
    "sampleRateHertz": 44100,
    "languageCode": "fr-FR"
  },
  "audio": {
    "uri": "gs://cloud-samples-data/speech/corbeau_renard.flac"
  }
}
EOF
```

#### 3. Call <SPEECH_REQUEST_FILE> and store the result in a file named <SPEECH_RESPONSE_FILE>.

```bash
export SPEECH_RESPONSE_FILE=<SPEECH_RESPONSE_FILE>
```

```bash
curl -s -X POST -H "Content-Type: application/json" \
 --data-binary @$SPEECH_REQUEST_FILE \
 "https://speech.googleapis.com/v1/speech:recognize?key=${API_KEY}" \
 -o $SPEECH_RESPONSE_FILE
```

---

## Task 4. Translate text with the Cloud Translation API

#### 1. For this task, connect to the VM instance lab-vm provisioned for you via SSH.

#### 2. Translate the <TRANSLATE_SENTENCE> sentence to the English language by calling the Cloud Translation API and store the result in the <TRANSLATION_RESPONSE_FILE> file.

```bash
export TRANSLATE_SENTENCE=<TRANSLATE_SENTENCE>
```

```bash
export TRANSLATION_RESPONSE_FILE=<TRANSLATION_RESPONSE_FILE>
```

```bash
curl -s -X POST \
  -H "Authorization: Bearer $(gcloud auth application-default print-access-token)" \
  -H "Content-Type: application/json; charset=utf-8" \
  -d "{\"q\": \"$TRANSLATE_SENTENCE\"}" \
  "https://translation.googleapis.com/language/translate/v2?key=${API_KEY}&source=ja&target=en" > $TRANSLATION_RESPONSE_FILE
```

---

## Task 5. Detect a language with the Cloud Translation API

#### 1. For this task, connect to the VM instance lab-vm provisioned for you via SSH.

#### 2. Detect the language of the <DETECT_SENTENCE> sentence by calling the Cloud Translation API and store the result in the <DETECTED_RESPONSE_FILE> file.

```bash
export DETECT_SENTENCE=<DETECT_SENTENCE>
```

```bash
export DETECTED_RESPONSE_FILE=<DETECTED_RESPONSE_FILE>
```

```bash
curl -s -X POST \
 -H "Authorization: Bearer $(gcloud auth application-default print-access-token)" \
  -H "Content-Type: application/json; charset=utf-8" \
  -d "{\"q\": [\"$DETECT_SENTENCE\"]}" \
  "https://translation.googleapis.com/language/translate/v2/detect?key=${API_KEY}" \
 -o $DETECTED_RESPONSE_FILE
```
