# Monitor and Log with Google Cloud Observability: Challenge Lab

## Task 1. Configure Cloud Monitoring

#### Your first task is to enable Cloud Monitoring for your project.

#### A basic Cloud Monitoring dashboard, called Media_Dashboard, will be made available to you automatically, but you have to enable Cloud Monitoring in your project before you will be able to access this dashboard.

---

## Task 2. Configure a Compute Instance to generate Custom Cloud Monitoring metrics

#### 1. Your next task is to confirm that the monitoring service that checks the length of the video processing queue is working correctly.

#### 2. You must modify the startup script for the video-queue-monitor Compute Instance so that the queue monitoring application (the Go application) can create and write to custom metrics. Once you have updated the startup script you will need to restart the instance.

> Open Google Cloud Console → Compute Engine → VM instances.

> Find the VM named **video-queue-monitor**.

> Click the 3-dot menu (or the row) → Stop. Wait until STOPPED.

> Click **video-queue-monitor** to open its details page.

> Click **Edit** (top bar).

> Scroll to **Custom metadata** (at env script section), change **project_id**: your GCP project ID and **instance_id**: this VM’s instance ID

> Click **Save** (at the bottom).

> Click **Start / Run** to boot the instance.

#### 3. You can confirm that the application is working by searching for the metric input_queue_size in the Metrics Explorer in Cloud Monitoring.

> Open Google Cloud Console → Logging → Logs Explorer.

> In the Query builder, paste the query from **Tip #4 in your tips & tricks section**.

> Click **Run query** to check that logs show up.

---

## Task 3. Create a custom metric using Cloud Operations logging events

#### 1. Examine the Cloud Operations logs and create a custom metric that tracks the total volume of uploaded media files to your Cloud Function. The video upload Cloud Function creates a Cloud Operations Logging event that includes metadata about the type of video file the video processing system handles.

#### 2. You have been asked to configure a custom log based metric called <CUSTOM_METRIC_NAME> that will monitor the rate at which high resolution video files, those recorded at either 4K or 8K resolution, are uploaded.

> Open Google Cloud Console → Logging → Logs Explorer.

> In the Query builder, paste the query from **Tip #4 in your tips & tricks section**.

> Click **Run query** to check that logs show up.

> On the top-right of the result, click **Actions** → **Create metric**.

> In the Create logs-based metric name, type: <CUSTOM_METRIC_NAME>

> Keep all other settings default.

> Click **Create metric**.

---

## Task 4. Add custom metrics to the Media Dashboard in Cloud Operations Monitoring

#### You must now add two charts to the Media Dashboard:

> In Google Cloud Console, go to **Monitoring → Dashboards**.

> From the list, find and click on **Media_Dashboard**.

#### 1. Add a chart for the video input queue length custom metric that is generated by the Go application running on the video-queue-monitor Compute Instance.

> Inside Media_Dashboard, click **Add widget**.

> From widget types, select **Line chart**.

> In the Metric field, type **VM Instance**

> Click the Active toggle/button. Choose VM Instance → Custom Metric → custom.googleapis.com/opencensus/my.videoservice.org.

> Select your metric and click **Apply**.

> In the widget settings, go to **Filter**.

> Choose **instance_id** and set the value to the **instance_id of video-queue-monitor VM**.

> Click **Apply**.

#### 2. Add a chart for the high resolution video upload rate custom log based metric to the Media_Dashboard custom dashboard.

> In Media_Dashboard, click **Add widget**.

> Select **Line chart**.

> In the Metric search box, type **logging**.

> Click the Active toggle/button. Choose VM Instance → Log-based metrics → <CUSTOM_METRIC_NAME>.

> Select it, then click **Apply**.

---

## Task 5. Create a Cloud Operations alert based on the rate of high resolution video file uploads

#### Create a custom alert using the high resolution video upload metric that triggers when the upload rate for large videos exceeds a count of <ALERT_TRESHOLD> per second.

> In Google Cloud Console, go to **Monitoring → Alerting**.

> Click **+ Create Policy**.

> In the Select a metric field, type **logging**.

> Click the **Active** button to show available metrics. Choose VM Instance → Log-based metrics → <CUSTOM_METRIC_NAME>.

> Select it and click **Apply**.

> Leave the rest of the metric settings as default, then click Next.

> In the **Threshold** value box, enter <ALERT_TRESHOLD>.

> Click **Next**.

> Deselect **Use notification channel** (so no email/SMS is sent).

> Name the **Alert policy name**.

> Click **Create**.
