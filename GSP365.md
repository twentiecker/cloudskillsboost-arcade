# Manage Data Models in Looker: Challenge Lab

## Task 1. Create LookML objects

#### When going through your company's LookML code base, you found a refinement that includes a weekly profit and revenue aggregate table. You assume that Looker will use this aggregate table for total profit and revenue queries that can leverage weekly granularity. The code for the refinement, however, contains errors and is only half-implemented. Furthermore, you also notice that the refinement contains objects that haven't been created yet.

#### To start, you will first need to create these LookML objects and then fix the refinement and aggregate table in the next section.

#### 1. Inside of the order_items view, create a new dimension and a new measure that calculate profit and total profit.

#### Requirements:

> Name these objects profit and total_profit.

> You need to use profit to create total_profit.

> For both profit and total_profit, set the value_format_name parameter to usd (US Dollars).

> Following best practices, you will need to add a description and label to both the measure and the dimension.

```bash
dimension: profit {
  type: number
  sql: ${sale_price} - ${products.cost} ;;
  description: "profit"
  label: "profit"
  value_format_name: usd
}

measure: total_profit {
  type: sum
  sql: ${profit} ;;
  description: "total_profit"
  label: "total_profit"
  value_format_name: usd
}
```

#### 2. Inside of the training_ecommerce.model file, create a new datagroup.

#### Requirements:

> Name the datagroup: <DATAGROUP_NAME>.

```bash
datagroup: <DATAGROUP_NAME> {}
```

> Set a maximum cache age of one week (168 hours). For the purposes of this challenge, you do not need to include an sql_trigger. You may receive a warning message which you can ignore for the purposes of this lab.

```bash
datagroup: <DATAGROUP_NAME> {
  max_cache_age: "168 hours"
}
```

> Set the <DATAGROUP_NAME> as the caching policy to use for all Explores in the model.

```bash
datagroup: <DATAGROUP_NAME> {
  max_cache_age: "168 hours"
}

persist_with: <DATAGROUP_NAME>
```

#### 3. Click Validate LookML to validate your code.

#### 4. Click Commit Changes and Push, then click Deploy to Production.

---

## Task 2. Create and fix a refinement with an aggregate table

#### Now that the objects referenced in the refinement and aggregate table have been properly created, you are ready to troubleshoot and fix the pre-existing code. In this section, you will be given broken LookML code for a refinement with an aggregate table that you will need to troubleshoot and fix. You will need to use the LookML objects you created in the previous section to complete this task.

#### 1. Start by copying the provided lab code into the training_ecommerce.model file, under the Events explore

#### 2. Click Save Changes then Validate LookML to see some of the errors that the code introduces.

#### 3. Fix the refinement and aggregate table LookML code. Requirements:

> Include a label for the refinement named: Order Items - Aggregate Profit and Revenue.

```bash
explore: +order_items {
  label: "Order Items - Aggregate Profit and Revenue"
  ...
}
```

> The query for the aggregate table must include the following dimensions and measures from the order_items view: created_date, total_revenue, total_profit.

```bash
explore: +order_items {
...
    query: {
      dimensions: [order_items.created_date]
      measures: [order_items.total_revenue, order_items.total_profit]
    }
...
}
```

> A datagroup_trigger that references <DATAGROUP_NAME> (which you created in the previous section). Be sure to include a time increment that references created_date to identify the time step for appending new data.

```bash
explore: +order_items {
...
    materialization: {
      datagroup_trigger: <DATAGROUP_NAME>
      increment_key: "created_date"
    }
...
}
```

#### 4. Click Commit Changes and Push, then click Deploy to Production.

## Create a visualization

#### 1. From the Order Items - Aggregate Profit and Revenue Explore, select Order Items > Created Date > Month, Total Revenue, and Total Profit. Make sure your Created Month column is in Ascending order.

#### 2. Create a Line visualization. It should resemble the following:

#### 3. Save this visualization as a Look and name it: <LOOK_TITLE>.

---

## Task 3. Extend a view

#### Now that you have fixed the code for the refinement and aggregate table, you have been requested to create a separate view that contains users' personally identifiable information (PII) and can be extended from other views.

#### This will enable future work to hide the PII from some teams, so that only people with certain levels of access will be able to see it. For the time being, all you need to do is create the extend for the PII and test that it can be extended from other views.

#### In this task, you will create a new view that contains user PII dimensions and test that it works by extending it from the existing users view.

#### 1. Create new view named <VIEW_NAME>. Place it in the views folder.

#### 2. Remove all the placeholder code, and add the following dimensions: first_name, last_name, email, id, latitude, and longitude.

#### 3. Extend this view from the users view.

#### Requirements:

> Set the id dimension as the primary key.

> Add the correct parameter to require extension for this view. The contents and settings of this view can only be used when the view is extended using the extends parameter in another view.

> Add the proper code to extend users.view using the <VIEW_NAME> view.

```bash
view: <VIEW_NAME> {
    extension: required

    dimension: first_name {
        type: string
        sql: ${TABLE}.first_name ;;
    }

    dimension: last_name {
        type: string
        sql: ${TABLE}.last_name ;;
    }

    dimension: email {
        type: string
        sql: ${TABLE}.email ;;
    }

    dimension: id {
        primary_key: yes
        type: number
        sql: ${TABLE}.id ;;
    }

    dimension: latitude {
        type: number
        sql: ${TABLE}.latitude ;;
    }

    dimension: longitude {
        type: number
        sql: ${TABLE}.longitude ;;
    }
}
```

> Hide the LookML code for the same PII dimensions in users.view.

```bash
hidden: yes
```

#### 4. Click Validate LookML to validate your code.

#### 5. Click Commit Changes and Push, then click Deploy to Production.

---

## Task 4. Group similar fields in views

#### For your final task, a data analyst on your team has requested you to group specific dimensions and measures for their business requirements. In this task, you will create two groups: one for general user information and one for product information. You will then add the associated dimensions and measures to each.

#### 1. Use the correct parameter to group the following dimensions in the users view into a new group named <GROUP_NAME_USER>:

> Age

> City

> Country

> State

```bash
group_label: "<GROUP_NAME_USER>"
```

#### 2. Create another group named <GROUP_NAME_PRODUCT> that includes the following dimensions in the products view:

> Brand

> Category

> Department

> Name

```bash
group_label: "<GROUP_NAME_PRODUCT>"
```

#### 3. Verify these groups are working as intended in the Explore by running two separate queries (one in each view: users and products) using all of the dimensions in the newly created group.

#### 4. Click Validate LookML to validate your code.

#### 5. Click Commit Changes and Push, then click Deploy to Production.
