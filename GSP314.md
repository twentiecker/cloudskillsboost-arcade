# Set Up a Google Cloud Network: Challenge Lab

---

## Task 1. Create networks

#### Create a VPC network with two subnets and firewalls to open connections between resources.

#### 1. Create a VPC network named <NETWORK_NAME> with two subnets: <SUBNET_A_NAME> and <SUBNET_B_NAME>. Use a Regional dynamic routing mode.

```bash
export NETWORK_NAME=<NETWORK_NAME>
```

#### 2. For <SUBNET_A_NAME> set the region to <NETWORK_REGION_1>.

#### Set the IP stack type to IPv4 (single-stack)

#### Set IPv4 range to 10.10.10.0/24

```bash
export SUBNET_A_NAME=<SUBNET_A_NAME>
```

```bash
export NETWORK_REGION_1=<NETWORK_REGION_1>
```

#### 3. For <SUBNET_B_NAME> set the region to <NETWORK_REGION_2>.

#### Set the IP stack type to IPv4 (single-stack)

#### Set IPv4 range to 10.10.20.0/24

```bash
export SUBNET_B_NAME=<SUBNET_B_NAME>
```

```bash
export NETWORK_REGION_2=<NETWORK_REGION_2>
```

```bash
gcloud compute networks create $NETWORK_NAME --subnet-mode=custom   --mtu=1460 --bgp-routing-mode=regional --bgp-best-path-selection-mode=legacy && gcloud compute networks subnets create $SUBNET_A_NAME --range=10.10.10.0/24 --stack-type=IPV4_ONLY --network=$NETWORK_NAME --region=$NETWORK_REGION_1 && gcloud compute networks subnets create $SUBNET_B_NAME --range=10.10.20.0/24 --stack-type=IPV4_ONLY --network=$NETWORK_NAME --region=$NETWORK_REGION_2
```

---

## Task 2. Add firewall rules

#### On this network your team will need to be able to connect to Linux and Windows machines using SSH and RDP, as well as diagnose network communication issues via ICMP.

#### 1. Create a firewall rule named <FIREWALL_RULE_1>.

#### For the network, use <NETWORK_NAME>.

#### Set the priority to 1000, the traffic to Ingress and action to Allow

#### The targets should be set to all instances in the network and the IPv4 ranges to 0.0.0.0/0

#### Set the Protocol to TCP and port to 22

```bash
export FIREWALL_RULE_1=<FIREWALL_RULE_1>
```

```bash
gcloud compute firewall-rules create $FIREWALL_RULE_1 --direction=INGRESS --priority=1000 --network=$NETWORK_NAME --action=ALLOW --rules=tcp:22 --source-ranges=0.0.0.0/0
```

#### 2. Create a firewall rule named <FIREWALL_RULE_2>.

#### For the network, use <NETWORK_NAME>.

#### Set the priority to 65535, the traffic to Ingress and action to Allow

#### The targets should be set to all instances in the network and the IPv4 ranges to 0.0.0.0/24

#### Set the Protocol to TCP and port to 3389

```bash
export FIREWALL_RULE_2=<FIREWALL_RULE_2>
```

```bash
gcloud compute firewall-rules create $FIREWALL_RULE_2 --direction=INGRESS --priority=65535 --network=$NETWORK_NAME --action=ALLOW --rules=tcp:3389 --source-ranges=0.0.0.0/24
```

#### 3. Create a firewall rule named <FIREWALL_RULE_3>.

#### For the network, use <NETWORK_NAME>.

#### Set the priority to 1000, the traffic to Ingress and action to Allow

#### The targets should be set to all instances in the network and the IPv4 ranges to 10.10.10.0/24 and 10.10.20.0/24

#### Set the Protocol to icmp

```bash
export FIREWALL_RULE_3=<FIREWALL_RULE_3>
```

```bash
gcloud compute firewall-rules create $FIREWALL_RULE_3 --direction=INGRESS --priority=1000 --network=$NETWORK_NAME --action=ALLOW --rules=icmp --source-ranges=10.10.10.0/24,10.10.20.0/24
```

---

## Task 3. Add VMs to your network

#### Create a virtual machine in each subnet, and confirm that the machines can communicate with each other using a protocol that you already set up. Each machine will use network tags that the firewall rules need to allow network traffic.

#### 1. Create an instance name us-test-01 in <SUBNET_A_NAME> and set the zone to <ZONE_1>.

```bash
export ZONE_1=<ZONE_1>
```

```bash
gcloud compute instances create us-test-01 --zone=$ZONE_1 --machine-type=e2-medium --network-interface=network-tier=PREMIUM,stack-type=IPV4_ONLY,subnet=$SUBNET_A_NAME
```

#### 2. Create an instance name us-test-02 in <SUBNET_B_NAME> and set the zone to <ZONE_2>.

```bash
export ZONE_2=<ZONE_2>
```

```bash
gcloud compute instances create us-test-02 --zone=$ZONE_2 --machine-type=e2-medium --network-interface=network-tier=PREMIUM,stack-type=IPV4_ONLY,subnet=$SUBNET_B_NAME
```
